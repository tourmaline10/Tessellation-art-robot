<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>敷き詰めアートロボット</title>
<style>
  body {
    font-family: sans-serif;
    text-align: center;
    background: #f5f5f5;
  }
  svg {
    background: white;
    border: 1px solid #999;
  }
  .controls {
    margin: 10px;
  }
</style>
</head>
<body>

<h2>敷き詰めアートロボット（教材版）</h2>

<div class="controls">
  図形：
  <select id="shape" onchange="redraw()">
    <option value="tri">正三角形</option>
    <option value="square">正方形</option>
    <option value="hex">正六角形</option>
  </select>

  回転：
  <select id="rotate" onchange="redraw()">
    <option value="0">0°</option>
    <option value="60">60°</option>
    <option value="90">90°</option>
    <option value="120">120°</option>
    <option value="180">180°</option>
  </select>

  色A：
  <input type="color" id="colorA" value="#ffffff" onchange="redraw()">
  色B：
  <input type="color" id="colorB" value="#555555" onchange="redraw()">
</div>

<svg id="svg" width="500" height="500"></svg>
<p id="comment"></p>

<script>
const RANGE = 40; // ← 描画をキャンバス外まで広げる
const svg = document.getElementById("svg");
const W = 500;
const H = 500;
const NS = "http://www.w3.org/2000/svg";

function clearSVG() {
  svg.innerHTML = "";
  const g = document.createElementNS(NS,"g");
  const rot = document.getElementById("rotate").value;
  g.setAttribute(
    "transform",
    `rotate(${rot}, ${W/2}, ${H/2})`
  );
  g.setAttribute("id","layer");
  svg.appendChild(g);
}

function layer() {
  return document.getElementById("layer");
}

function color(x, y) {
  const a = document.getElementById("colorA").value;
  const b = document.getElementById("colorB").value;
  return (x + y) % 2 === 0 ? a : b;
}

function redraw() {
  clearSVG();
  const shape = document.getElementById("shape").value;
  if (shape === "hex") drawHex();
  if (shape === "tri") drawTri();
  if (shape === "square") drawSquare();
}

function drawHex() {
  const r = 30;
  const dx = Math.sqrt(3) * r;
  const dy = 1.5 * r;

  for (let row = -RANGE; row < RANGE; row++) {
    for (let col = -RANGE; col < RANGE; col++) {

      const cx = W/2 + col * dx + (row % 2) * (dx / 2);
      const cy = H/2 + row * dy;

      const p = document.createElementNS(NS,"polygon");
      p.setAttribute("points", hexPoints(cx, cy, r));
      p.setAttribute("fill", color(col, row));
      p.setAttribute("stroke", "white");
      p.setAttribute("stroke-width", "2");

      layer().appendChild(p);
    }
  }

  document.getElementById("comment").textContent =
    "正六角形は 120°×3 = 360° となり、すき間なく敷き詰められます。";
}

/* ---------- 正三角形（辺でくっつく敷き詰め） ---------- */
function triPoints(x, y, s, up) {
  const h = Math.sqrt(3) / 2 * s;
  return up
    ? `${x},${y+h} ${x+s/2},${y} ${x+s},${y+h}`
    : `${x},${y} ${x+s},${y} ${x+s/2},${y+h}`;
}

function drawTri() {
  const s = 40;
  const h = Math.sqrt(3) / 2 * s;

  for (let row = -RANGE; row < RANGE; row++) {
  for (let col = -RANGE; col < RANGE; col++) {
    const x = col * (s / 2);
    const y = row * h;
    const up = (row + col) % 2 === 0;

    const p = document.createElementNS(NS,"polygon");
    p.setAttribute("points", triPoints(x, y, s, up));
    p.setAttribute("fill", color(col, row));
    p.setAttribute("stroke", "white");
    p.setAttribute("stroke-width", "1.2");
    layer().appendChild(p);
  }
}

  document.getElementById("comment").textContent =
    "正三角形は辺どうしがぴったり重なり、60°×6 = 360° で敷き詰められます。";
}

/* ---------- 正方形（全面敷き詰め） ---------- */
function drawSquare() {
  const s = 40;

  for (let y = -1; y < 15; y++) {
    for (let x = -1; x < 15; x++) {
      const r = document.createElementNS(NS,"rect");
　　　  r.setAttribute("x", W/2 + x * s);
　　　　r.setAttribute("y", H/2 + y * s);
      r.setAttribute("width", s);
      r.setAttribute("height", s);
      r.setAttribute("fill", color(x, y));
      r.setAttribute("stroke", "white");
      r.setAttribute("stroke-width", "2");
      layer().appendChild(r);
    }
  }

  document.getElementById("comment").textContent =
    "正方形は 90°×4 = 360° で、完全に敷き詰められます。";
}

redraw();
</script>

</body>
</html>
