<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<title>Tessellation Art Robot</title>

<style>
  body {
    font-family: system-ui, sans-serif;
    text-align: center;
    background: #f5f5f5;
  }
  svg {
    background: white;
    margin: 16px auto;
    display: block;
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
  }
  button, select {
    padding: 10px 16px;
    margin: 6px;
    font-size: 16px;
  }
</style>
</head>

<body>

<h1>ğŸ¨ Tessellation Art Robot</h1>

<select id="pattern">
  <option value="square">â–¡ å››è§’</option>
  <option value="circle">â—‹ å††</option>
  <option value="triangle">â–³ ä¸‰è§’</option>
</select>

<br>

<button id="regen">ğŸ” å†ç”Ÿæˆ</button>
<button id="save">ğŸ’¾ PNGä¿å­˜</button>

<svg
  id="art"
  width="400"
  height="400"
  viewBox="0 0 400 400"
  xmlns="http://www.w3.org/2000/svg">
</svg>

<script>
const SIZE = 40;
const ROWS = 10;
const COLS = 10;

function rand(max) {
  return Math.floor(Math.random() * max);
}

function randomColor() {
  return `rgb(${rand(256)}, ${rand(256)}, ${rand(256)})`;
}

function generate() {
  const svg = document.getElementById('art');
  const pattern = document.getElementById('pattern').value;

  while (svg.firstChild) {
    svg.removeChild(svg.firstChild);
  }

  for (let y = 0; y < ROWS; y++) {
    for (let x = 0; x < COLS; x++) {

      if (pattern === 'square') {
        const r = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
        r.setAttribute('x', x * SIZE);
        r.setAttribute('y', y * SIZE);
        r.setAttribute('width', SIZE);
        r.setAttribute('height', SIZE);
        r.setAttribute('fill', randomColor());
        svg.appendChild(r);
      }

      if (pattern === 'circle') {
        const c = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
        c.setAttribute('cx', x * SIZE + SIZE / 2);
        c.setAttribute('cy', y * SIZE + SIZE / 2);
        c.setAttribute('r', SIZE / 2);
        c.setAttribute('fill', randomColor());
        svg.appendChild(c);
      }

      if (pattern === 'triangle') {
        const p = document.createElementNS('http://www.w3.org/2000/svg', 'polygon');
        const x0 = x * SIZE;
        const y0 = y * SIZE;
        p.setAttribute(
          'points',
          `${x0},${y0 + SIZE} ${x0 + SIZE / 2},${y0} ${x0 + SIZE},${y0 + SIZE}`
        );
        p.setAttribute('fill', randomColor());
        svg.appendChild(p);
      }
    }
  }
}

/* Safariå¯¾å¿œ PNGä¿å­˜ */
function savePNG() {
  const svg = document.getElementById('art');
  const data = new XMLSerializer().serializeToString(svg);
  const svgBlob = new Blob([data], { type: 'image/svg+xml;charset=utf-8' });
  const url = URL.createObjectURL(svgBlob);

  const img = new Image();
  img.onload = () => {
    const canvas = document.createElement('canvas');
    canvas.width = 400;
    canvas.height = 400;
    const ctx = canvas.getContext('2d');
    ctx.drawImage(img, 0, 0);
    URL.revokeObjectURL(url);

    const a = document.createElement('a');
    a.href = canvas.toDataURL('image/png');
    a.download = 'tessellation-art.png';
    a.click();
  };
  img.src = url;
}

document.getElementById('regen').onclick = generate;
document.getElementById('save').onclick = savePNG;

generate();
</script>

</body>
</html>
